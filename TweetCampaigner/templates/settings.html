{% extends "base.html" %}

{% block title %}Settings - Twitter Campaign Manager{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-5 fw-bold">
                <i class="fas fa-cog me-2"></i>Settings
            </h1>
            <p class="lead text-muted">Manage your account preferences and integrations</p>
        </div>
    </div>

    <div class="row">
        <!-- Settings Navigation -->
        <div class="col-lg-3 mb-4">
            <div class="card">
                <div class="card-body">
                    <div class="nav flex-column nav-pills" role="tablist">
                        <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#profile" type="button" role="tab">
                            <i class="fas fa-user me-2"></i>Profile
                        </button>
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#twitter" type="button" role="tab">
                            <i class="fab fa-twitter me-2"></i>Twitter Integration
                        </button>
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#ai" type="button" role="tab">
                            <i class="fas fa-robot me-2"></i>AI Settings
                        </button>
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#notifications" type="button" role="tab">
                            <i class="fas fa-bell me-2"></i>Notifications
                        </button>
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#security" type="button" role="tab">
                            <i class="fas fa-shield-alt me-2"></i>Security
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Content -->
        <div class="col-lg-9">
            <div class="tab-content">
                <!-- Profile Settings -->
                <div class="tab-pane fade show active" id="profile" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-user me-2"></i>Profile Information
                            </h5>
                        </div>
                        <div class="card-body">
                            <form method="POST">
                                <input type="hidden" name="update_profile" value="1">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="username" class="form-label">Username</label>
                                            <input type="text" class="form-control" id="username" value="{{ current_user.username }}" readonly>
                                            <div class="form-text">Username cannot be changed</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="email" class="form-label">Email Address</label>
                                            <input type="email" class="form-control" id="email" name="email" value="{{ current_user.email }}" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="timezone" class="form-label">Timezone</label>
                                            <select class="form-select" id="timezone">
                                                <option value="UTC">UTC - Coordinated Universal Time</option>
                                                <option value="America/New_York">Eastern Time (ET)</option>
                                                <option value="America/Chicago">Central Time (CT)</option>
                                                <option value="America/Denver">Mountain Time (MT)</option>
                                                <option value="America/Los_Angeles" selected>Pacific Time (PT)</option>
                                                <option value="Europe/London">London (GMT)</option>
                                                <option value="Europe/Paris">Paris (CET)</option>
                                                <option value="Asia/Tokyo">Tokyo (JST)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="language" class="form-label">Language</label>
                                            <select class="form-select" id="language">
                                                <option value="en" selected>English</option>
                                                <option value="es">Spanish</option>
                                                <option value="fr">French</option>
                                                <option value="de">German</option>
                                                <option value="it">Italian</option>
                                                <option value="pt">Portuguese</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="bio" class="form-label">Bio</label>
                                    <textarea class="form-control" id="bio" rows="3" placeholder="Tell us about yourself and your business..."></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Changes
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Twitter Integration -->
                <div class="tab-pane fade" id="twitter" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fab fa-twitter me-2"></i>Twitter Account Integration
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if current_user.has_twitter_auth() %}
                                <div class="alert alert-success">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-check-circle me-2"></i>Twitter Account Connected
                                    </h6>
                                    <p class="mb-2">Your Twitter account is successfully connected and ready for automated posting.</p>
                                    <hr>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-outline-success btn-sm" onclick="testConnection()">
                                            <i class="fas fa-wifi me-1"></i>Test Connection
                                        </button>
                                        <button class="btn btn-outline-danger btn-sm" onclick="disconnectTwitter()">
                                            <i class="fas fa-unlink me-1"></i>Disconnect
                                        </button>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body text-center">
                                                <i class="fas fa-check-circle text-success fa-2x mb-2"></i>
                                                <h6>Authentication Status</h6>
                                                <span class="badge bg-success">Connected</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body text-center">
                                                <i class="fas fa-shield-alt text-primary fa-2x mb-2"></i>
                                                <h6>Permissions</h6>
                                                <small class="text-muted">Read, Write, Follow</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <div class="alert alert-warning">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-exclamation-triangle me-2"></i>Twitter Account Not Connected
                                    </h6>
                                    <p class="mb-0">Connect your Twitter account to enable automated posting and analytics tracking.</p>
                                </div>

                                <div class="text-center py-4">
                                    <i class="fab fa-twitter fa-5x text-primary mb-3"></i>
                                    <h5>Connect Your Twitter Account</h5>
                                    <p class="text-muted mb-4">
                                        Safely connect your Twitter account to enable automated posting, 
                                        scheduling, and performance analytics.
                                    </p>
                                    
                                    <form method="POST" class="d-inline">
                                        <input type="hidden" name="twitter_auth" value="1">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fab fa-twitter me-2"></i>Connect Twitter Account
                                        </button>
                                    </form>
                                </div>

                                <div class="mt-4">
                                    <h6>What permissions are required?</h6>
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            <strong>Read:</strong> Access your profile information and follower count
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            <strong>Write:</strong> Post tweets and schedule content on your behalf
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            <strong>Analytics:</strong> Access engagement metrics and performance data
                                        </li>
                                    </ul>
                                    
                                    <div class="alert alert-info mt-3">
                                        <small>
                                            <i class="fas fa-info-circle me-1"></i>
                                            We use secure OAuth authentication and never store your Twitter password. 
                                            You can revoke access at any time from your Twitter account settings.
                                        </small>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- AI Settings -->
                <div class="tab-pane fade" id="ai" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-robot me-2"></i>AI Content Generation Settings
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="tone" class="form-label">Content Tone</label>
                                        <select class="form-select" id="tone">
                                            <option value="professional" selected>Professional</option>
                                            <option value="casual">Casual & Friendly</option>
                                            <option value="enthusiastic">Enthusiastic</option>
                                            <option value="informative">Informative</option>
                                            <option value="humorous">Humorous</option>
                                        </select>
                                        <div class="form-text">Default tone for AI-generated content</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="creativity" class="form-label">Creativity Level</label>
                                        <select class="form-select" id="creativity">
                                            <option value="conservative">Conservative</option>
                                            <option value="balanced" selected>Balanced</option>
                                            <option value="creative">Creative</option>
                                            <option value="experimental">Experimental</option>
                                        </select>
                                        <div class="form-text">How creative should AI content be</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Content Preferences</label>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="includeEmojis" checked>
                                            <label class="form-check-label" for="includeEmojis">
                                                Include Emojis
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="includeHashtags" checked>
                                            <label class="form-check-label" for="includeHashtags">
                                                Auto-include Hashtags
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="includeCTA">
                                            <label class="form-check-label" for="includeCTA">
                                                Include Call-to-Action
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="blacklist" class="form-label">Prohibited Words/Phrases</label>
                                <textarea class="form-control" id="blacklist" rows="2" 
                                          placeholder="Words or phrases to avoid in generated content (comma-separated)"></textarea>
                                <div class="form-text">AI will avoid using these terms in generated content</div>
                            </div>

                            <div class="mb-3">
                                <label for="brandVoice" class="form-label">Brand Voice Guidelines</label>
                                <textarea class="form-control" id="brandVoice" rows="3" 
                                          placeholder="Describe your brand voice and personality to help AI generate more aligned content..."></textarea>
                            </div>

                            <button type="button" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Save AI Settings
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="tab-pane fade" id="notifications" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-bell me-2"></i>Notification Preferences
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-4">
                                <h6>Email Notifications</h6>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="emailCampaigns" checked>
                                    <label class="form-check-label" for="emailCampaigns">
                                        Campaign status updates
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="emailFailed" checked>
                                    <label class="form-check-label" for="emailFailed">
                                        Failed tweet notifications
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="emailWeekly">
                                    <label class="form-check-label" for="emailWeekly">
                                        Weekly performance reports
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="emailTrending">
                                    <label class="form-check-label" for="emailTrending">
                                        Trending hashtag alerts
                                    </label>
                                </div>
                            </div>

                            <div class="mb-4">
                                <h6>In-App Notifications</h6>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="appSuccess" checked>
                                    <label class="form-check-label" for="appSuccess">
                                        Successful tweet posts
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="appErrors" checked>
                                    <label class="form-check-label" for="appErrors">
                                        Error notifications
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="appMilestones">
                                    <label class="form-check-label" for="appMilestones">
                                        Engagement milestones
                                    </label>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Save Notification Settings
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Security -->
                <div class="tab-pane fade" id="security" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-shield-alt me-2"></i>Security & Privacy
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-4">
                                <h6>Change Password</h6>
                                <form>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="currentPassword" class="form-label">Current Password</label>
                                                <input type="password" class="form-control" id="currentPassword">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="newPassword" class="form-label">New Password</label>
                                                <input type="password" class="form-control" id="newPassword">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                                <input type="password" class="form-control" id="confirmPassword">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary">
                                        <i class="fas fa-key me-2"></i>Update Password
                                    </button>
                                </form>
                            </div>

                            <div class="mb-4">
                                <h6>Data & Privacy</h6>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="dataCollection" checked>
                                    <label class="form-check-label" for="dataCollection">
                                        Allow anonymous usage analytics to improve the platform
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="dataSharing">
                                    <label class="form-check-label" for="dataSharing">
                                        Share aggregated performance data for industry benchmarks
                                    </label>
                                </div>
                            </div>

                            <div class="mb-4">
                                <h6>Account Actions</h6>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-outline-info">
                                        <i class="fas fa-download me-2"></i>Export Data
                                    </button>
                                    <button type="button" class="btn btn-outline-danger" onclick="confirmDeleteAccount()">
                                        <i class="fas fa-trash me-2"></i>Delete Account
                                    </button>
                                </div>
                                <div class="form-text mt-2">
                                    Deleting your account will permanently remove all your campaigns, tweets, and analytics data.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modals -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>Delete Account
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p><strong>Are you sure you want to delete your account?</strong></p>
                <p>This action cannot be undone. All your data will be permanently deleted:</p>
                <ul>
                    <li>All campaigns and scheduled tweets</li>
                    <li>Analytics and performance data</li>
                    <li>Account settings and preferences</li>
                    <li>Twitter integration settings</li>
                </ul>
                <div class="mb-3">
                    <label for="confirmDelete" class="form-label">Type "DELETE" to confirm:</label>
                    <input type="text" class="form-control" id="confirmDelete" placeholder="DELETE">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled>
                    <i class="fas fa-trash me-2"></i>Delete Account
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function testConnection() {
    // Show loading state
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Testing...';
    btn.disabled = true;
    
    // Simulate connection test
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        alert('Connection test successful! Your Twitter integration is working properly.');
    }, 2000);
}

function disconnectTwitter() {
    if (confirm('Are you sure you want to disconnect your Twitter account? This will disable automated posting.')) {
        // In real implementation, this would make a request to disconnect
        alert('Twitter account disconnected successfully.');
        location.reload();
    }
}

function confirmDeleteAccount() {
    const modal = new bootstrap.Modal(document.getElementById('deleteAccountModal'));
    modal.show();
}

// Enable delete button only when "DELETE" is typed correctly
document.getElementById('confirmDelete').addEventListener('input', function() {
    const deleteBtn = document.getElementById('confirmDeleteBtn');
    if (this.value === 'DELETE') {
        deleteBtn.disabled = false;
    } else {
        deleteBtn.disabled = true;
    }
});

// Handle delete account confirmation
document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
    alert('Account deletion functionality would be implemented here.');
    bootstrap.Modal.getInstance(document.getElementById('deleteAccountModal')).hide();
});

// Save settings functions
document.querySelectorAll('.btn-primary').forEach(btn => {
    if (btn.textContent.includes('Save')) {
        btn.addEventListener('click', function() {
            // Show success message
            const alert = document.createElement('div');
            alert.className = 'alert alert-success alert-dismissible fade show mt-3';
            alert.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>Settings saved successfully!
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            this.parentElement.appendChild(alert);
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                if (alert.parentElement) {
                    alert.remove();
                }
            }, 3000);
        });
    }
});
</script>
{% endblock %}
